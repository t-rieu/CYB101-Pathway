# Malware Analysis

**Malware**
- **Virus -** malicious code that replicates itself on the computer.
  - It has to be activated before it can spread.
- **Worms -** malicious code that affects the computer.
  - It is self-replicating and can email itself to others.
- **Trojan horse -** malware is concealed within a seemingly useful program. The malware is executed once the program is run.
- **Ransomware -** llocks access to assets until a sum is paid.
  - It mainly targets government, education, banks, manufacturing, energy & utilities.
 
**Blended threat -** combines multiple threats into one package. *Eg. using a trojan horse to sneak in a virus.*

**Antivirus software -** a type of program that prevents, detects, and eradicates malware.
- **Malware signature -** disables software with sequences of code typical to a specific piece of malware.
  - It can only protect against known threats.

<img width="605" alt="Screenshot 2024-11-10 at 4 54 23 PM" src="https://github.com/user-attachments/assets/4f3b0a98-0416-40ac-8d95-65f9999a7dc1">
<img width="616" alt="Screenshot 2024-11-10 at 4 54 30 PM" src="https://github.com/user-attachments/assets/82aef1f6-b6fe-4f05-8af5-55d8c23477a4">

- **System monitoring -** the software can monitor a system’s behavior.
  - Atypical behavior is flagged. *Eg. unusually large increase in data usage, and attempts to access a large number of files.*
  - Provides real-time protection.
 
**Malware analysis**
- **Process isolation -** process address spaces are separated to ensure other processes can’t tamper with each other.
- **Virtual machine -** simulates all aspects of a hardware device.
  - Allows users to test how malware interacts with file systems, registry, etc.
  - However, some malware can detect VMs and behave differently inside them.
  - There is some risk of an escape attack.
- **Docker containers -** a package of software that includes everything needed to run an application.
  - It provides isolation from host systems but there can still be a risk of an escape attack because the OS kernel is shared between containers and host.
- ** Sandboxes -** opens up files in a carefully isolated environment and observes the effects of the file.
  - Threat actors can evade sandboxing by delaying malware execution because sandboxes typically run malware for a short time. Delaying it prevents the malware from exhibiting malicious behavior that the sandbox analyzes.
 
**Forensic analysis -** analysis of digital evidence and investigation of security incidents.
  - Common artifacts include windows event logs, file metadata, deleted files, browser history, cookies, cache, download history, firewall logs, etc.
  - **PCAP -** a file that contains packet data.
    - Applications such as Wireshark are crucial to analyze pcaps.
  - Forensic analysts have to ask questions such as:
    - What damage has been done?
    - Who was the perpetrator? How were the security measures passed?
    - Did the perpetrator leave anything behind such as a new account or malware?
    - Is there enough data to reproduce the attack and test it against a new control(s)?
  - In order to properly identify suspicious network activities, there are [reference files](https://wiki.wireshark.org/samplecaptures) for standard network behaviors.
  - Suspicious activities include:
    - Unusual communication pairs (nodes that don’t typically communicate suddenly are).
    - Unusual protocols and ports (understand what ports are open and active in the network. Unfamiliar open ports are suspicious).
    - Excessive failed connections.
    - Suspicious inbound connections.
   
## Project
**Creating a single payload**
<img width="848" alt="Screenshot 2024-11-10 at 4 56 03 PM" src="https://github.com/user-attachments/assets/f18c0f8e-f213-469f-a1d9-fa779e779329">
```
Syntax: msfvenom -a ARCHITECTURE --platform PLATFORM -p PAYLOAD [ARGS] -f FORMAT -o OUTPUTFILE
-a specifies the computer architecture for the payload.
--platform specifies the OS/programming language the payload will run on.
-p details the functions of the virus (this is the payload).
-f the format of the file.
-o the name of the virus file.
```
**Creating a multi-payload**
<img width="845" alt="Screenshot 2024-11-10 at 4 58 52 PM" src="https://github.com/user-attachments/assets/f85a0672-369a-4008-8575-b2e752271e15">
- Create the first payload to create a multi-payload. The -c flag allows you to add more payloads. This virus causes the computer to say, “You’ve been pwned!” aloud.

**Creating an encrypted payload**
<img width="842" alt="Screenshot 2024-11-10 at 5 00 15 PM" src="https://github.com/user-attachments/assets/6febca2b-2ec4-45e4-ad24-1bac8240c598">
- **x86/shikata_ga_nai** is a polymorphic XOR additive feedback encoder. 



